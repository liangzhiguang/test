<!DOCTYPE html>
<html>
<head>
    <title></title>
    <style>
        .button-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }
        .button-container button {
            margin: 5px;
        }
    </style>
    <script>
        function copyToClipboard(text) {
            var textarea = document.createElement("textarea");
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand("copy");
            document.body.removeChild(textarea);
        }

        function parsePromptFile() {
            var file = "prompt.txt";
            var rawFile = new XMLHttpRequest();
            rawFile.open("GET", file, true);
            rawFile.onreadystatechange = function () {
                if (rawFile.readyState === 4 && rawFile.status === 200) {
                    var content = rawFile.responseText;
                    var prompts = content.match(/\[(.*?)开始\](.*?)\[(.*?)结束\]/gs);
                    
                    if (prompts) {
                        for (var i = 0; i < prompts.length; i++) {
                            var promptMatch = prompts[i].match(/\[(.*?)开始\](.*?)\[(.*?)结束\]/s);
                            var promptStart = promptMatch[1];
                            var promptContent = promptMatch[2];
                            var promptEnd = promptMatch[3];

                            var button = document.createElement("button");
                            button.innerHTML = "先复制 " + promptStart;
                            button.onclick = function() {
                                var prompt = this.innerHTML.substring(6);
                                copyPromptToClipboard(prompt);
                            }

                            document.getElementById("button-container").appendChild(button);
                        }
                    } else {
                        alert("未找到任何提示词！");
                    }
                }
            }
            rawFile.send();
        }

        function copyPromptToClipboard(prompt) {
            var file = "prompt.txt";
            var rawFile = new XMLHttpRequest();
            rawFile.open("GET", file, true);
            rawFile.onreadystatechange = function () {
                if (rawFile.readyState === 4 && rawFile.status === 200) {
                    var content = rawFile.responseText;
                    var promptRegex = new RegExp(`\\[${prompt}开始\\](.*?)\\[${prompt}结束\\]`, "s");
                    var promptMatch = content.match(promptRegex);

                    if (promptMatch) {
                        var promptContent = promptMatch[1].trim().split("\n").slice(1).join("\n");
                        copyToClipboard(promptContent);
                        alert("已复制 " + prompt + " 到剪贴板！");
                    } else {
                        alert("未找到指定内容！");
                    }
                }
            }
            rawFile.send();
        }
    </script>
</head>
<body>
    <div class="button-container" id="button-container"></div>
    <script>
        parsePromptFile();
    </script>
</body>
</html>
