<!DOCTYPE html>
<html>
<head>
    <title></title>
    <script>
        function copyToClipboard(text) {
            var textarea = document.createElement("textarea");
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand("copy");
            document.body.removeChild(textarea);
        }

        function readFile() {
            var file = "prompt.txt";
            var rawFile = new XMLHttpRequest();
            rawFile.open("GET", file, true);
            rawFile.onreadystatechange = function () {
                if (rawFile.readyState === 4 && rawFile.status === 200) {
                    var content = rawFile.responseText;
                    var prompts = content.match(/\[(.*?)开始\]/g);
                    if (prompts) {
                        for (var i = 0; i < prompts.length; i++) {
                            var prompt = prompts[i].substring(1, prompts[i].length - 3);
                            var button = document.createElement("button");
                            button.innerHTML = "先复制 " + prompt;
                            button.onclick = function() {
                                copyPromptToClipboard(this.innerHTML.substring(6));
                            }
                            document.body.appendChild(button);
                        }
                    } else {
                        alert("未找到任何提示词！");
                    }
                }
            }
            rawFile.send();
        }

        function copyPromptToClipboard(prompt) {
            var file = "prompt.txt";
            var rawFile = new XMLHttpRequest();
            rawFile.open("GET", file, true);
            rawFile.onreadystatechange = function () {
                if (rawFile.readyState === 4 && rawFile.status === 200) {
                    var content = rawFile.responseText;
                    var startIndex = content.indexOf("[" + prompt + "开始]");
                    var endIndex = content.indexOf("[" + prompt + "结束]");
                    if (startIndex !== -1 && endIndex !== -1 && startIndex < endIndex) {
                        var trimmedContent = content.substring(startIndex + prompt.length + 2, endIndex).trim().split("\n").slice(1).join("\n");
                        copyToClipboard(trimmedContent);
                        alert("已复制 " + prompt + " 到剪贴板！");
                    } else {
                        alert("未找到指定内容！");
                    }
                }
            }
            rawFile.send();
        }
    </script>
</head>
<body>
    <button onclick="readFile()">检测并生成按钮</button>

    <script>
        readFile();
    </script>
</body>
</html>
