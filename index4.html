<!DOCTYPE html>
<html>

<head>
    <title></title>
    <script>
        function copyToClipboard(text) {
            var textarea = document.createElement("textarea");
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand("copy");
            document.body.removeChild(textarea);
        }

        function readFile() {
            var file = "prompt.txt";
            var rawFile = new XMLHttpRequest();
            rawFile.open("GET", file, true);
            rawFile.onreadystatechange = function() {
                if (rawFile.readyState === 4 && rawFile.status === 200) {
                    var content = rawFile.responseText;
                    var prompts = extractPrompts(content);
                    generateButtons(prompts);
                }
            }
            rawFile.send();
        }

        function extractPrompts(content) {
            var promptStart = "[";
            var promptEnd = "开始]";
            var prompts = [];
            var startIndex = content.indexOf(promptStart);
            while (startIndex !== -1) {
                var endIndex = content.indexOf(promptEnd, startIndex);
                if (endIndex !== -1) {
                    var prompt = content.substring(startIndex + promptStart.length, endIndex);
                    prompts.push(prompt);
                    startIndex = content.indexOf(promptStart, endIndex);
                } else {
                    break;
                }
            }
            return prompts;
        }

        function generateButtons(prompts) {
            var buttonContainer = document.getElementById("button-container");
            buttonContainer.innerHTML = "";

            prompts.forEach(function(prompt) {
                var button = document.createElement("button");
                button.innerText = "先复制 " + prompt;
                button.onclick = function() {
                    copyPromptToClipboard(prompt);
                };
                buttonContainer.appendChild(button);
            });
        }

        function copyPromptToClipboard(prompt) {
            var file = "prompt.txt";
            var rawFile = new XMLHttpRequest();
            rawFile.open("GET", file, true);
            rawFile.onreadystatechange = function() {
                if (rawFile.readyState === 4 && rawFile.status === 200) {
                    var content = rawFile.responseText;
                    var startIndex = content.indexOf("[" + prompt + "开始]");
                    var endIndex = content.indexOf("[" + prompt + "结束]");
                    if (startIndex !== -1 && endIndex !== -1 && startIndex < endIndex) {
                        var trimmedContent = content.substring(startIndex + prompt.length + 2, endIndex).trim().split("\n").slice(1).join("\n");
                        copyToClipboard(trimmedContent);
                        alert("已复制 " + prompt + " 到剪贴板！");
                    } else {
                        alert("未找到指定内容！");
                    }
                }
            }
            rawFile.send();
        }

        window.onload = function() {
            readFile();
        };
    </script>
</head>

<body>
    <div id="button-container"></div>
</body>

</html>
